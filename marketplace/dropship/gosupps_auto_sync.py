# -*- coding: utf-8 -*-
"""Untitled0.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1MpDbQhYOO3_gqQmkZ5GSsxgh3QkUXQ44
"""

# gosupps_auto_sync.py

import os
import requests
from go_supps_connector import fetch_go_supps_products
from smart_tags import generate_tags, apply_price_strategy

SHOPIFY_STORE_URL = os.getenv("SHOPIFY_STORE_URL")
SHOPIFY_API_KEY = os.getenv("SHOPIFY_API_KEY")
SHOPIFY_API_PASSWORD = os.getenv("SHOPIFY_API_PASSWORD")

def create_shopify_product(product):
    if not all([SHOPIFY_STORE_URL, SHOPIFY_API_KEY, SHOPIFY_API_PASSWORD]):
        print("‚ùå Missing Shopify credentials.")
        return

    url = f"{SHOPIFY_STORE_URL}/admin/api/2023-04/products.json"
    auth = (SHOPIFY_API_KEY, SHOPIFY_API_PASSWORD)

    tags = generate_tags(product['title'])
    price = apply_price_strategy(product['price'])

    payload = {
        "product": {
            "title": product['title'],
            "body_html": f"<img src='{product['image']}' /><p>Imported from GoSupps</p>",
            "vendor": "GoSupps",
            "tags": tags,
            "images": [{"src": product['image']}],
            "variants": [{
                "price": price,
                "inventory_management": "shopify",
                "inventory_quantity": 10
            }]
        }
    }

    response = requests.post(url, json=payload, auth=auth)
    if response.status_code == 201:
        print(f"‚úÖ Created: {product['title']}")
    else:
        print(f"‚ùå Failed: {product['title']} ‚Äî {response.status_code}")
        print(response.text)

def main():
    print("üîÑ Auto-sync started...")
    products = fetch_go_supps_products()

    if not products:
        print("‚ùå No products found.")
        return

    for product in products:
        create_shopify_product(product)

if __name__ == "__main__":
    main()